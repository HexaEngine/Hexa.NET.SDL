name: Build and Upload SDL3 Artifacts

on: [workflow_dispatch]

jobs:
  build:
    uses: JunaMeinhold/cmake-actions/.github/workflows/cmake.yml@v1.x.x
    with:
      lib-name: SDL3
      repo: libsdl-org/SDL
      repo-tag: release-3.4.0
      repo-path: SDL
      cmake-flags: "-DCMAKE_BUILD_TYPE=Release -DSDL_STATIC=OFF -DSDL_SHARED=ON"
      cmake-flags-windows: "-DCMAKE_SYSTEM_VERSION=10.0.26100.0"
      cmake-flags-android: "-DCMAKE_POSITION_INDEPENDENT_CODE=ON"
      ndk-version: "26.3.11579264"
      android-api: "21"
      build-output-dir: artifacts
      bin-name-osx: libSDL3.dylib
      bin-name-linux: libSDL3.so
      bin-name-android: libSDL3.so
      bin-name-windows: Release/SDL3.dll
      bin-name-osx-normalized: libSDL3.dylib
      bin-name-linux-normalized: libSDL3.so
      bin-name-android-normalized: libSDL3.so
      bin-name-windows-normalized: SDL3.dll
      linux-deps: "build-essential git make pkg-config cmake ninja-build gnome-desktop-testing libasound2-dev libpulse-dev libaudio-dev libfribidi-dev libjack-dev libsndio-dev libx11-dev libxext-dev libxrandr-dev libxcursor-dev libxfixes-dev libxi-dev libxss-dev libxtst-dev libxkbcommon-dev libdrm-dev libgbm-dev libgl1-mesa-dev libgles2-mesa-dev libegl1-mesa-dev libdbus-1-dev libibus-1.0-dev libudev-dev libthai-dev libpipewire-0.3-dev libwayland-dev libdecor-0-dev"
      android-deps: "build-essential cmake ninja-build"

  create-pr:
    uses: JunaMeinhold/cmake-actions/.github/workflows/create-pr.yml@v1.x.x
    needs: [build]
    with:
      lib-name: SDL3
      lib-version: release-3.4.0
      pr-branch: sdl3-artifacts-branch
      pr-base-branch: master
      pr-reviewers: JunaMeinhold
